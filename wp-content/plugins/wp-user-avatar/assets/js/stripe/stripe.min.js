"use strict";!function($){(new function(){var e=this,t=!1,s=Stripe(ppress_stripe_vars.publishable_key,{locale:ppress_stripe_vars.locale});this.init=function(){window.processCheckoutFlag=!1,$(document).on("ppress_updated_checkout",e.updated_checkout),$(document).on("ppress_update_checkout",e.unmountCardElement),$(document).on("click","#ppress-checkout-button",(function(){window.processCheckoutFlag=!0}))},this.updated_checkout=function(){e.checkout_form=$("form#ppress_mb_checkout_form"),e.checkout_form.on("ppress_checkout_place_order_stripe",e.tokenRequest),e.checkout_form.on("ppress_process_checkout_stripe",e.processCheckout),e.mountCardElement()},this.mountCardElement=function(){0!==$("#ppress-stripe-card-element").length&&(t=s.elements().create("card",ppress_stripe_vars.createCardOptions)).mount("#ppress-stripe-card-element")},this.unmountCardElement=function(){0!==$("#ppress-stripe-card-element").length&&void 0!==t.unmount&&t.destroy()},this.tokenRequest=function(){if(!0===window.processCheckoutFlag)return $("#ppress_stripe_payment_method").remove(),s.createPaymentMethod({type:"card",card:t,billing_details:{name:$("#stripe-card_name").val(),email:$("#ppmb_email").val(),address:{city:$("#stripe_ppress_billing_city").val(),country:$("#stripe_ppress_billing_country").val(),line1:$("#stripe_ppress_billing_address").val(),postal_code:$("#stripe_ppress_billing_postcode").val(),state:$("#stripe_ppress_billing_state").val()}}}).then((function(t){"error"in t&&void 0!==t.error.message?ppressCheckoutForm.createAlertMessage(t.error.message):(window.processCheckoutFlag=!1,e.checkout_form.append('<input id="ppress_stripe_payment_method" type="hidden" name="ppress_stripe_payment_method" value="'+t.paymentMethod.id+'">'),e.checkout_form.submit())})),!1},this.processCheckout=function(e,t,r){var n;if(!0===ppressCheckoutForm.is_var_defined(t.gateway_response)&&(!0===ppressCheckoutForm.is_var_defined(t.gateway_response.latest_invoice)&&!0===ppressCheckoutForm.is_var_defined(t.gateway_response.latest_invoice.payment_intent)&&!0===ppressCheckoutForm.is_var_defined(t.gateway_response.latest_invoice.payment_intent.status)&&"requires_action"===t.gateway_response.latest_invoice.payment_intent.status||!0===ppressCheckoutForm.is_var_defined(t.gateway_response.status)&&"requires_action"===t.gateway_response.status))return n=ppressCheckoutForm.is_var_defined(t.gateway_response.client_secret)?t.gateway_response.client_secret:t.gateway_response.latest_invoice.payment_intent.client_secret,s.confirmCardPayment(n).then((function(e){e.error?ppressCheckoutForm.createAlertMessage(e.error.message):"succeeded"===e.paymentIntent.status&&($(document.body).trigger("ppress_checkout_success",[t,r]),window.location.assign(t.order_success_url))})),!1}}).init()}(jQuery);